# æ•…éšœæ’é™¤æŒ‡å— - Troubleshooting Guide

æœ¬æ–‡æ¡£æä¾›äº† Mask Truffle AI é¡¹ç›®å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚

## ğŸ”§ é’±åŒ…è¿æ¥é—®é¢˜

### é—®é¢˜1ï¼šé’±åŒ…è¿æ¥å¤±è´¥ä½†æç¤ºè¿æ¥æˆåŠŸ

**ç—‡çŠ¶**ï¼šç‚¹å‡»è¿æ¥é’±åŒ…åæç¤ºæˆåŠŸï¼Œä½†å®é™…ä¸Šé’±åŒ…æœªè¿æ¥

**åŸå› **ï¼šé”™è¯¯å¤„ç†é€»è¾‘ä¸å®Œå–„ï¼Œæœªæ­£ç¡®æ£€æŸ¥è¿æ¥çŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ MetaMask å·²å®‰è£…å¹¶è§£é”
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥
4. ç¡®ä¿ MetaMask ä¸­è‡³å°‘æœ‰ä¸€ä¸ªè´¦æˆ·

```javascript
// æ£€æŸ¥ MetaMask æ˜¯å¦å·²å®‰è£…
if (typeof window.ethereum === 'undefined') {
  console.error('è¯·å®‰è£… MetaMask');
}

// æ£€æŸ¥è´¦æˆ·è¿æ¥çŠ¶æ€
const accounts = await window.ethereum.request({ method: 'eth_accounts' });
if (accounts.length === 0) {
  console.log('æœªè¿æ¥ä»»ä½•è´¦æˆ·');
}
```

### é—®é¢˜2ï¼šä¸æ”¯æŒçš„ç½‘ç»œé”™è¯¯

**ç—‡çŠ¶**ï¼šè¿æ¥é’±åŒ…æ—¶æç¤º"ä¸æ”¯æŒçš„ç½‘ç»œ"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨ MetaMask ä¸­åˆ‡æ¢åˆ°æ”¯æŒçš„ç½‘ç»œï¼ˆä¸»ç½‘ã€Sepoliaã€æœ¬åœ°ç½‘ç»œï¼‰
2. æˆ–è€…åœ¨é¡¹ç›®ä¸­æ·»åŠ æ›´å¤šæ”¯æŒçš„ç½‘ç»œID

```javascript
// åœ¨ WalletConnection.js ä¸­æ·»åŠ æ›´å¤šæ”¯æŒçš„ç½‘ç»œ
const injectedConnector = new InjectedConnector({
  supportedChainIds: [
    1,        // Mainnet
    5,        // Goerli
    11155111, // Sepolia
    1337,     // Local
    // æ·»åŠ æ›´å¤šç½‘ç»œID
  ],
});
```

## ğŸ”— åˆçº¦éƒ¨ç½²é—®é¢˜

### é—®é¢˜3ï¼šåˆçº¦éƒ¨ç½²å¤±è´¥

**ç—‡çŠ¶**ï¼šè¿è¡Œ `npm run migrate` æ—¶å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ Ganache æ˜¯å¦è¿è¡Œ**
```bash
# å¯åŠ¨æœ¬åœ°åŒºå—é“¾
npm run ganache
```

2. **æ£€æŸ¥ç½‘ç»œé…ç½®**
ç¡®ä¿ `truffle-config.js` ä¸­çš„ç½‘ç»œé…ç½®æ­£ç¡®ï¼š
```javascript
development: {
  host: '127.0.0.1',
  port: 8545,
  network_id: '*',
}
```

3. **æ£€æŸ¥è´¦æˆ·ä½™é¢**
ç¡®ä¿éƒ¨ç½²è´¦æˆ·æœ‰è¶³å¤Ÿçš„ ETH æ”¯ä»˜ gas è´¹ç”¨

4. **é‡æ–°éƒ¨ç½²**
```bash
npm run migrate:reset
```

### é—®é¢˜4ï¼šåˆçº¦åœ°å€æœªæ›´æ–°

**ç—‡çŠ¶**ï¼šå‰ç«¯æ— æ³•ä¸åˆçº¦äº¤äº’

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. éƒ¨ç½²æˆåŠŸåï¼Œå°†åˆçº¦åœ°å€æ›´æ–°åˆ° `client/src/services/DataStorageService.js`
2. æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½® `REACT_APP_CONTRACT_ADDRESS`

## ğŸ–¥ï¸ å‰ç«¯é—®é¢˜

### é—®é¢˜5ï¼šå‰ç«¯å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼šè¿è¡Œ `npm run dev` æ—¶å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ä¾èµ–å®‰è£…**
```bash
npm run install-all
```

2. **æ¸…é™¤ç¼“å­˜**
```bash
cd client
rm -rf node_modules package-lock.json
npm install
```

3. **æ£€æŸ¥ç«¯å£å ç”¨**
é»˜è®¤ç«¯å£ 3000 å¯èƒ½è¢«å ç”¨ï¼Œå°è¯•ä½¿ç”¨å…¶ä»–ç«¯å£ï¼š
```bash
cd client
PORT=3001 npm start
```

### é—®é¢˜6ï¼šWeb3 ç›¸å…³é”™è¯¯

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ§åˆ¶å°å‡ºç° Web3 ç›¸å…³é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ä½¿ç”¨ HTTPS æˆ– localhostï¼ˆä¸è¦ä½¿ç”¨ HTTPï¼‰
2. æ£€æŸ¥ MetaMask ç‰ˆæœ¬æ˜¯å¦æœ€æ–°
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ MetaMask æ•°æ®

## ğŸ“¦ ä¾èµ–é—®é¢˜

### é—®é¢˜7ï¼šnpm å®‰è£…å¤±è´¥

**ç—‡çŠ¶**ï¼šè¿è¡Œ `npm install` æ—¶å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ¸…é™¤ç¼“å­˜**
```bash
npm cache clean --force
```

2. **åˆ é™¤ node_modules**
```bash
rm -rf node_modules package-lock.json
npm install
```

3. **ä½¿ç”¨ä¸åŒçš„åŒ…ç®¡ç†å™¨**
```bash
# å°è¯•ä½¿ç”¨ yarn
yarn install
```

4. **æ£€æŸ¥ Node.js ç‰ˆæœ¬**
ç¡®ä¿ä½¿ç”¨ Node.js 16+ ç‰ˆæœ¬

### é—®é¢˜8ï¼šTruffle ç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶**ï¼šè¿è¡Œ `truffle compile` æ—¶å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ Solidity ç‰ˆæœ¬**
ç¡®ä¿ `truffle-config.js` ä¸­çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸åˆçº¦ç‰ˆæœ¬åŒ¹é…

2. **æ¸…é™¤æ„å»ºç¼“å­˜**
```bash
npm run clean
npm run compile
```

3. **æ£€æŸ¥ OpenZeppelin ç‰ˆæœ¬**
ç¡®ä¿ä½¿ç”¨å…¼å®¹çš„ OpenZeppelin ç‰ˆæœ¬

## ğŸ” è°ƒè¯•æŠ€å·§

### å¯ç”¨è¯¦ç»†æ—¥å¿—

1. **æµè§ˆå™¨æ§åˆ¶å°**
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - æŸ¥çœ‹ Console æ ‡ç­¾é¡µä¸­çš„é”™è¯¯ä¿¡æ¯

2. **MetaMask è°ƒè¯•**
   - æ‰“å¼€ MetaMask è®¾ç½®
   - å¯ç”¨"æ˜¾ç¤ºæµ‹è¯•ç½‘ç»œ"
   - æŸ¥çœ‹æ´»åŠ¨æ—¥å¿—

3. **Truffle è°ƒè¯•**
```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
truffle migrate --verbose-rpc
truffle test --verbose-rpc
```

### å¸¸ç”¨æ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥ Truffle ç‰ˆæœ¬
truffle version

# æ£€æŸ¥ç½‘ç»œè¿æ¥
truffle console
> web3.eth.getAccounts()

# æ£€æŸ¥åˆçº¦çŠ¶æ€
truffle console
> const instance = await DataStorage.deployed()
> instance.address
> await instance.getStats()
```

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šè§£å†³æ–¹æ¡ˆéƒ½ä¸èƒ½è§£å†³æ‚¨çš„é—®é¢˜ï¼š

1. **æ£€æŸ¥é¡¹ç›®æ–‡æ¡£**
   - é˜…è¯» [README.md](./README.md)
   - æŸ¥çœ‹ä»£ç æ³¨é‡Š

2. **æœç´¢å·²çŸ¥é—®é¢˜**
   - æŸ¥çœ‹ [GitHub Issues](https://github.com/juzhiqiang/mask-truffle-ai/issues)
   - æœç´¢ç›¸å…³é”™è¯¯ä¿¡æ¯

3. **åˆ›å»ºæ–°çš„ Issue**
   - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
   - åŒ…å«ç¯å¢ƒä¿¡æ¯ï¼ˆNode.jsç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç­‰ï¼‰
   - æè¿°é‡ç°æ­¥éª¤

4. **ç¤¾åŒºæ”¯æŒ**
   - Truffle å®˜æ–¹æ–‡æ¡£
   - Ethereum å¼€å‘è€…ç¤¾åŒº
   - Stack Overflow

## ğŸ“± ç¯å¢ƒè¦æ±‚æ£€æŸ¥æ¸…å•

- [ ] Node.js >= 16.0.0
- [ ] npm >= 8.0.0
- [ ] MetaMask æµè§ˆå™¨æ‰©å±•å·²å®‰è£…
- [ ] è‡³å°‘ä¸€ä¸ªä»¥å¤ªåŠè´¦æˆ·
- [ ] æµ‹è¯•ç½‘ç»œ ETHï¼ˆç”¨äºæµ‹è¯•ç½‘éƒ¨ç½²ï¼‰
- [ ] æ­£ç¡®çš„ç½‘ç»œé…ç½®
- [ ] é˜²ç«å¢™å…è®¸ç›¸å…³ç«¯å£ï¼ˆ3000, 8545ï¼‰

## ğŸ”„ é‡ç½®é¡¹ç›®

å¦‚æœé‡åˆ°ä¸¥é‡é—®é¢˜ï¼Œå¯ä»¥å®Œå…¨é‡ç½®é¡¹ç›®ï¼š

```bash
# 1. æ¸…ç†æ‰€æœ‰ä¾èµ–
rm -rf node_modules client/node_modules
rm package-lock.json client/package-lock.json

# 2. æ¸…ç†æ„å»ºæ–‡ä»¶
rm -rf build client/build

# 3. é‡æ–°å®‰è£…
npm run setup

# 4. é‡æ–°éƒ¨ç½²
npm run migrate:reset
```

---

å¦‚æœæ‚¨å‘ç°å…¶ä»–å¸¸è§é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿æäº¤ Pull Request æ¥å®Œå–„è¿™ä»½æŒ‡å—ï¼

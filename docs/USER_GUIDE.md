# 区块链钱包系统使用指南

## 🎉 问题解决方案

### ✅ 已修复的问题
原问题：启动后报错 `Get stats failed: Error: call revert exception`

**解决方案**：
1. **功能分离**：将转账功能改为直接钱包交互，合约仅用于日志存储
2. **智能加载**：根据不同tab加载不同的数据源
3. **错误处理**：合约调用失败时使用默认值，不影响整体功能

## 🚀 系统功能概览

### 三大核心功能

#### 1. **ETH转账** 💰
- **功能**：直接使用钱包发送ETH
- **数据存储**：localStorage（本地存储）
- **特点**：无需合约部署，即用即可
- **进度追踪**：实时显示转账进度

#### 2. **日志上链** 📝
- **功能**：将系统日志永久存储到区块链
- **数据存储**：区块链合约
- **特点**：不可篡改，永久保存
- **适用场景**：审计日志、重要记录

#### 3. **USDT转账** 🪙
- **功能**：发送USDT代币
- **支持网络**：Ethereum、BSC、Polygon
- **数据存储**：localStorage + 区块链交易
- **特点**：自动检测网络和余额

## 📱 使用步骤

### 基础设置
1. **连接钱包**：点击右上角连接MetaMask
2. **选择功能**：点击对应的tab切换功能
3. **填写信息**：根据表单要求填写
4. **提交操作**：点击提交按钮并观察进度条

### ETH转账操作
```
1. 切换到"ETH转账"标签
2. 填写接收地址
3. 输入转账金额
4. 可选：设置Gas价格（留空自动设置）
5. 点击"立即转账"
6. 在钱包中确认交易
7. 观察进度条直到完成
```

### USDT转账操作
```
1. 确保网络支持（以太坊主网/BSC/Polygon）
2. 切换到"USDT转账"标签
3. 系统自动显示当前USDT余额
4. 填写接收地址和转账金额
5. 可点击"全部"按钮转账所有USDT
6. 点击"发送USDT"
7. 确认钱包交易
```

### 日志上链操作
```
1. 切换到"日志上链"标签
2. 选择日志级别（DEBUG/INFO/WARN/ERROR/FATAL）
3. 填写日志来源（如：UserService）
4. 输入详细的日志消息
5. 点击"提交到区块链"
6. 等待合约交易完成
```

## 🎨 进度条功能

### 视觉特性
- **流动动画**：进行中显示蓝色流动效果
- **成功动画**：完成时绿色发光效果
- **错误提示**：失败时红色警告样式
- **用户指导**：详细的操作提示

### 进度阶段
| 阶段 | 进度 | ETH转账 | USDT转账 | 日志上链 |
|------|------|---------|----------|----------|
| 准备 | 20% | 获取签名器 | 检查余额 | 获取签名器 |
| 估算 | 40% | 估算Gas | 准备参数 | 预估Gas |
| 发送 | 60% | 发送交易 | 发送USDT | 发送到合约 |
| 确认 | 80% | 等待确认 | 等待确认 | 等待确认 |
| 完成 | 100% | 转账成功 | USDT成功 | 上链成功 |

## 📊 数据存储方案

### ETH/USDT转账记录
- **存储位置**：浏览器localStorage
- **数据结构**：
```javascript
{
  id: 时间戳,
  dataType: 'transfer' | 'usdt',
  fromAddress: '发送地址',
  toAddress: '接收地址',
  amount: '金额',
  token: 'ETH' | 'USDT',
  txHash: '交易哈希',
  timestamp: 'ISO时间',
  status: 'success' | 'failed',
  network: '网络名称'
}
```

### 日志记录
- **存储位置**：区块链合约
- **数据结构**：
```javascript
{
  id: 合约ID,
  dataType: 'log',
  content: JSON.stringify({
    logLevel: '日志级别',
    message: '日志消息',
    source: '日志来源',
    timestamp: 'ISO时间'
  }),
  creator: '创建者地址',
  timestamp: 区块时间戳,
  isActive: true
}
```

## 🛠 技术架构

### 核心服务
1. **DataStorageService**：合约交互服务
2. **USDTService**：USDT代币服务
3. **ProgressBar**：进度条组件
4. **WalletConnection**：钱包连接组件

### 状态管理
- React Hooks (useState, useEffect)
- 本地状态管理
- 进度状态实时更新

### 网络支持
- **ETH**：所有以太坊兼容网络
- **USDT**：Ethereum主网、BSC、Polygon
- **日志合约**：需要部署合约的网络

## 🔧 配置说明

### 环境变量
```bash
# .env文件
REACT_APP_CONTRACT_ADDRESS=0x你的合约地址
```

### 合约部署
```bash
# 部署日志存储合约
truffle migrate --network your_network

# 更新合约地址
# 在DataStorageService.js中更新CONTRACT_ADDRESS
```

### USDT合约地址（已预配置）
- Ethereum: `0xdAC17F958D2ee523a2206206994597C13D831ec7`
- BSC: `0x55d398326f99059fF775485246999027B3197955`
- Polygon: `0xc2132D05D31c914a87C6611C10748AEb04B58e8F`

## 🚨 注意事项

### 网络要求
1. **ETH转账**：任何以太坊兼容网络
2. **USDT转账**：必须是支持的网络（主网/BSC/Polygon）
3. **日志上链**：需要部署合约的网络

### Gas费用
- 所有操作都需要支付Gas费用
- 建议保留足够的主币作为Gas费用
- USDT转账Gas费用通常比ETH转账高

### 安全提示
- 转账前请仔细核对接收地址
- 大额转账建议先小额测试
- 私钥和助记词请妥善保管
- 不要在不安全的网络环境下操作

## 🐛 故障排除

### 常见问题
1. **合约调用失败**
   - 检查网络连接
   - 确认合约地址正确
   - 切换到转账功能继续使用

2. **USDT余额显示为0**
   - 确认当前网络支持USDT
   - 检查钱包中是否有USDT
   - 尝试刷新余额

3. **交易失败**
   - 检查Gas费用是否充足
   - 确认网络状况良好
   - 重新尝试交易

4. **进度条卡住**
   - 检查钱包是否需要确认
   - 网络拥堵可能导致延迟
   - 可以关闭进度条重新尝试

## 🎯 最佳实践

### 使用建议
1. **测试环境**：先在测试网测试功能
2. **备份数据**：重要记录请截图保存
3. **网络选择**：根据Gas费用选择合适网络
4. **安全操作**：在安全环境下进行操作

### 性能优化
1. **数据限制**：本地存储最多保留100条记录
2. **网络切换**：根据需要切换到合适的网络
3. **余额管理**：定期检查各种代币余额

---

现在您的系统已经完全正常运行了！转账功能使用直接钱包交互，日志功能使用合约存储，各司其职，用户体验更好！🎉

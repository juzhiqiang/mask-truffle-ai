# 自定义数据功能使用指南

## 🎉 新增功能概述

现在系统的所有功能都支持添加自定义数据，让您可以在转账和日志操作中携带额外的信息！

### ✨ 支持的功能
- **ETH转账** + 自定义数据 → 编码到交易的data字段
- **USDT转账** + 自定义数据 → 保存到本地记录
- **日志上链** + 自定义数据 → 永久存储到区块链合约

## 🛠 自定义数据类型

### 支持的数据类型
| 类型 | 说明 | 示例 |
|------|------|------|
| **文本** | 字符串类型 | `"用户备注"`, `"重要标记"` |
| **数字** | 数值类型 | `100`, `3.14`, `0` |
| **布尔值** | true/false | `true`, `false` |
| **JSON** | 复杂对象 | `{"level": 1, "tags": ["重要"]}` |

## 📝 使用方法

### 步骤1：添加自定义字段
1. 在任意功能页面，找到 **"自定义数据字段"** 折叠面板
2. 点击展开，然后点击 **"添加自定义字段"** 按钮
3. 系统会添加一行新的字段输入框

### 步骤2：配置字段
```
字段名：输入字段的名称（如：priority, category, memo）
类型：  选择数据类型（文本/数字/布尔值/JSON）
字段值：输入具体的值
```

### 步骤3：提交数据
- 填写完基础信息和自定义字段后，点击提交
- 系统会将自定义数据与主要数据一起处理

## 🎯 应用场景示例

### ETH转账 + 自定义数据
```javascript
// 基础转账信息
接收地址: 0x742d35Cc4Bf63f063a1b5aE5b4c9E2D5f0123456
转账金额: 0.1 ETH
备注信息: 工资发放

// 自定义数据字段
department: "技术部"        (文本)
employee_id: 1001         (数字)
is_bonus: true            (布尔值)
details: {"month": 12}    (JSON)
```

**结果**：自定义数据会被编码到ETH交易的data字段中，永久记录在区块链上！

### 日志上链 + 自定义数据
```javascript
// 基础日志信息
日志级别: ERROR
日志来源: PaymentService
日志消息: 用户支付失败
分类: business
标签: 支付,错误,重要

// 自定义数据字段
user_id: 12345            (数字)
error_code: "PAY_001"     (文本)
retry_needed: true        (布尔值)
context: {"ip": "1.2.3.4", "amount": 100}  (JSON)
```

**结果**：所有数据永久存储在区块链合约中，不可篡改！

### USDT转账 + 自定义数据
```javascript
// 基础转账信息
接收地址: 0x742d35Cc4Bf63f063a1b5aE5b4c9E2D5f0123456
USDT金额: 100.50
备注信息: 采购款项

// 自定义数据字段
invoice_number: "INV-2024-001"  (文本)
supplier_id: 5678              (数字)
urgent: false                  (布尔值)
items: ["laptop", "mouse"]     (JSON数组)
```

**结果**：自定义数据保存到本地记录中，便于管理和查询！

## 📊 数据查看和管理

### 在记录表格中查看
- **自定义数据列**：显示 "查看(N)" 按钮，N为字段数量
- **点击查看**：弹窗显示所有自定义数据的详细信息
- **格式化显示**：JSON格式美化，类型标识清晰

### 自定义数据Modal功能
- **完整数据展示**：以JSON格式显示所有字段
- **字段详情表格**：列出每个字段的名称、值和类型
- **类型标识**：用不同颜色的标签标识数据类型

## 🔧 高级用法

### 1. JSON类型数据示例
```json
{
  "metadata": {
    "version": "1.0",
    "timestamp": "2024-01-01T00:00:00Z"
  },
  "tags": ["重要", "紧急"],
  "config": {
    "enabled": true,
    "level": 5
  }
}
```

### 2. 常用字段建议
| 场景 | 建议字段 | 类型 | 说明 |
|------|----------|------|------|
| 转账 | `purpose` | 文本 | 转账目的 |
| 转账 | `priority` | 数字 | 优先级(1-5) |
| 转账 | `auto_retry` | 布尔值 | 失败是否重试 |
| 日志 | `user_id` | 数字 | 相关用户ID |
| 日志 | `session_id` | 文本 | 会话标识 |
| 日志 | `extra_info` | JSON | 额外信息 |

### 3. 数据验证规则
- **字段名**：不能为空，建议使用英文和下划线
- **JSON格式**：必须是有效的JSON，系统会自动验证
- **数据大小**：建议单个字段值不超过1KB

## 💡 最佳实践

### 数据设计原则
1. **字段命名**：使用有意义的英文名称
2. **类型选择**：根据实际数据选择合适类型
3. **JSON使用**：复杂结构化数据使用JSON类型
4. **数据精简**：避免存储过大或不必要的数据

### 使用建议
1. **ETH转账**：关键业务数据可以存储到链上
2. **日志上链**：重要审计信息适合永久存储
3. **USDT转账**：辅助信息存储到本地即可

### 安全注意事项
- 不要在自定义数据中存储敏感信息（如密码、私钥）
- ETH转账的自定义数据会公开显示在区块链上
- 日志上链的数据无法删除，请谨慎添加

## 🎨 界面功能

### 折叠面板设计
- **默认折叠**：不影响主要功能的使用
- **计数显示**：显示当前已添加的字段数量
- **一键展开**：方便快速添加多个字段

### 操作便利性
- **批量添加**：可以添加多个自定义字段
- **即时删除**：每个字段都有删除按钮
- **类型切换**：可以随时更改字段类型
- **一键重置**：重置表单时自动清空自定义字段

## 📋 数据存储详情

### ETH转账自定义数据
- **存储位置**：区块链交易的data字段
- **编码方式**：JSON字符串 → UTF-8 → Hex编码
- **查看方式**：通过区块浏览器可以查看原始数据
- **永久性**：永久存储，不可修改

### 日志自定义数据
- **存储位置**：智能合约storage
- **数据结构**：与日志内容一起JSON序列化
- **查询方式**：通过合约方法查询
- **持久性**：永久保存，去中心化存储

### USDT转账自定义数据
- **存储位置**：浏览器localStorage
- **数据格式**：JavaScript对象
- **备份建议**：重要数据请手动备份
- **限制**：浏览器存储限制（通常5-10MB）

---

🎉 现在您可以为每一笔转账和每一条日志添加个性化的数据了！这让系统更加灵活，能够满足各种复杂的业务需求！
